import os
import copy
import numpy as np
import open3d as o3d


def find_indexes(vertices, alters):
    indexes = []
    for alter in alters:
        x, z, y = alter
        target = copy.deepcopy(vertices)
        target[:, 0] = abs(target[:, 0] - x)
        target[:, 1] = abs(target[:, 1] - y)
        target[:, 2] = abs(target[:, 2] + z)
        result = np.sum(target, axis=1)
        index = np.argmin(result)
        indexes.append(index)
        print(result.min())


def get_alters():
    # Global 좌표
    standing = [
        [-0.000003, 0.025424, 0.441971],  # 머리마루점
        [-0.046556, -0.068851, 0.328275],  # 눈초리점(우)
        [0.046712, -0.06869, 0.328387],  # 눈초리점(좌)
        [-0.076753, 0.002704, 0.309184],  # 귀구슬점(우)
        [0.076753, 0.002697, 0.309187],  # 귀구슬점(좌)
        [-0.077523, 0.00283, 0.320535],  # 귀바퀴위뿌리점(우)
        [0.077522, 0.002824, 0.320538],  # 귀바퀴위뿌리점(좌)
        [-0.075982, 0.025449, 0.300651],  # 귀바퀴뒤뿌리점(우) 이거뭐야
        [0.000073, -0.092186, 0.351445],  # 눈살점(미간)
        [0.000269, -0.093741, 0.337248],  # 코뿌리점(Sellion)
        [0.000015, -0.090321, 0.210503],  # 턱끝점(Menton)
        [-0.000003, 0.116093, 0.352571],  # 뒤통수 돌출점(Occiput)
        [-0.000003, 0.07858, 0.251812],  # 뒤통수점(Inion)
        [-0.068402, -0.03547, 0.347917],  # 머리옆점(Euryon, 우)
        [0.068958, -0.034751, 0.348294],  # 머리옆점(Euryon, 좌)
        [-0.03405, -0.077515, 0.322053],  # 눈확아래점(Inferior Orbitale, 우)
        [0.033958, -0.077413, 0.322128],  # 눈확아래점(Inferior Orbitale, 좌)
        [0.000004, 0.097569, 0.157897],  # 목뒤점(Cervicale)
        [0.000005, -0.030337, 0.12267],  # 목앞점(Anterior Neck)
        [-0.060985, 0.007459, 0.180173],  # 목옆점(Lateral Neck, 우)
        [0.061099, 0.007635, 0.180319],  # 목옆점(Lateral Neck, 좌)
        [-0.000006, -0.046593, 0.177639],  # 방패연골아래점(Inferior Thyroid)
        [-0.179889, 0.024175, 0.151491],  # 어깨점(Acromion, 우)
        [0.179892, 0.024178, 0.151493],  # 어깨점(Acromion, 좌)
        [-0.118015, 0.038155, 0.154849],  # 어깨가쪽점(Lateral Shoulder, 우)
        [0.118019, 0.03816, 0.15485],  # 어깨가쪽점(Lateral Shoulder, 좌)
        [-0.221789, 0.028579, -0.003102],  # 겨드랑이점(Axilla, 우)
        [0.221788, 0.028579, -0.003101],  # 겨드랑이점(Axilla, 좌)
        [-0.207827, -0.004973, 0.017877],  # 겨드랑앞점(Anterior Axilla, 우)
        [0.207826, -0.004974, 0.01788],  # 겨드랑앞점(Anterior Axilla, 좌)
        [-0.222151, 0.082484, -0.004028],  # 겨드랑뒤점(Posterior Axilla, 우)
        [0.222146, 0.082482, -0.004028],  # 겨드랑뒤점(Posterior Axilla, 좌)
        [-0.173052, -0.030637, 0.091265],  # 겨드랑앞벽점(Anterior MidAxilla, 우)
        [0.173054, -0.030636, 0.09127],  # 겨드랑앞벽점(Anterior MidAxilla, 좌)
        [-0.14755, 0.116413, 0.098559],  # 겨드랑뒤벽점(Anterior MidAxilla, 우)
        [0.147547, 0.116415, 0.098557],  # 겨드랑뒤벽점(Anterior MidAxilla, 좌)
        [0.000003, 0.124056, 0.064129],  # 등뼈위겨드랑수준점(Axillary Level at Midspine)
        [-0.199998, -0.030044, 0.035669],  # 겨드랑앞접힘점(Anterior Axillary Fold, 우)
        [0.199999, -0.030045, 0.035673],  # 겨드랑앞접힘점(Anterior Axillary Fold, 좌)
        [-0.222151, 0.082484, -0.004028],  # 겨드랑뒤점(Posterior Axilla, 우)
        [0.222146, 0.082482, -0.004028],  # 겨드랑뒤점(Posterior Axilla, 좌)
        [0.000004, -0.078771, 0.032336],  # 복장뼈가운데점(Mesosternal)
        [-0.107037, -0.105581, -0.050393],  # 젖꼭지점(Nipple, 우)
        [0.107042, -0.105592, -0.050393],  # 젖꼭지점(Nipple, 좌)
        [-0.13146, -0.07267, -0.081184],  # 젖가슴아래수준(Inferior Breast level, 우)
        [0.131466, -0.07268, -0.081184],  # 젖가슴아래수준(Inferior Breast level, 좌)
        [-0.155495, -0.007942, -0.216804],  # 허리옆점(Lateral Waist, 우)
        [0.155496, -0.007948, -0.21681],  # 허리옆점(Lateral Waist, 좌)
        [0.000004, -0.132918, -0.233358],  # 허리앞점(Anterior Waist)
        [-0.000003, 0.091046, -0.236951],  # 허리뒤점(Posterior Waist)
        [-0.155495, -0.007942, -0.216804],  # 허리수준(Lateral Waist level, 우)
        [0.155496, -0.007948, -0.21681],  # 허리수준(Lateral Waist level, 좌)
        [-0.160365, -0.001689, -0.155293],  # 중간허리수준(Midriff level, 우)
        [0.160367, -0.001697, -0.155296],  # 중간허리수준(Midriff level, 좌)
        [0.000002, -0.131549, -0.256985],  # 배돌출점(Stomach tip)
        [0.000001, -0.126774, -0.290072],  # 배꼽점(Stomach navel)
        [-0.164664, 0.013356, -0.270792],  # 배꼽수준허리옆점(Lateral Waist omphalion, 우)
        [0.164664, 0.013356, -0.270792],  # 배꼽수준허리옆점(Lateral Waist omphalion, 좌)
        [-0.000003, 0.100244, -0.289525],  # 배꼽수준허리뒤점(Posterior Waist omphalion)
        [-0.061006, 0.153625, -0.415752],  # 엉덩이돌출점(Buttock Protrusion, 우)
        [0.061006, 0.153625, -0.415752],  # 엉덩이돌출점(Buttock Protrusion, 좌)
        [0.061006, 0.153625, -0.415752],  # 엉덩이돌출점수준(Buttock Protrusion level, 우)
        [0.098136, -0.088733, -0.41456],  # 엉덩이돌출점수준(Buttock Protrusion level, 좌)
        [-0.062043, 0.13964, -0.367867],  # Top-hip점(Top-hip, 우)
        [0.062042, 0.139637, -0.367867],  # Top-hip점(Top-hip, 좌)
        [-0.062043, 0.13964, -0.367867],  # Top-hip 수준(Top-hip level, 우)
        [0.096788, -0.087541, -0.365453],  # Top-hip 수준(Top-hip level, 좌)
        [-0.083322, 0.123794, -0.344732],  # Upper-hip점(Upper-hip, 우)
        [0.083322, 0.123794, -0.344732],  # Upper-hip점(Upper-hip, 좌)
        [-0.083322, 0.123794, -0.344732],  # Upper-hip 수준(Upper-hip level, 우)
        [0.09703, -0.08834, -0.344718],  # Upper-hip 수준(Upper-hip level, 좌)
        [-0.180726, 0.023082, -0.448773],  # 엉덩이최대둘레수준(Hip-width level, 우)
        [0.180726, 0.023082, -0.448773],  # 엉덩이최대둘레수준(Hip-width level, 좌)
        [-0.090556, 0.113142, -0.540854],  # 볼기고랑점(Gluteal Fold, 우)
        [0.090556, 0.113142, -0.540854],  # 볼기고랑점(Gluteal Fold, 좌)
        [-0.000001, -0.033277, -0.555264],  # 샅점(Crotch)
        [-0.09652, -0.04576, -0.868488],  # 무릎뼈위점(Superior Patella, 우)
        [0.09652, -0.04576, -0.868488],  # 무릎뼈위점(Superior Patella, 좌)
        [-0.095054, -0.036428, -0.893663],  # 무릎뼈가운데점(Midpatella, 우)
        [0.095054, -0.036428, -0.893663],  # 무릎뼈가운데점(Midpatella, 좌)
        [-0.095372, -0.023985, -0.916178],  # 무릎뼈아래점(Inferior Patella, 우)
        [0.095372, -0.023985, -0.916178],  # 무릎뼈아래점(Inferior Patella, 좌)
        [-0.18718, 0.0109, -0.527117],  # 넙적다리가운데점(Midthigh, 우)
        [0.18718, 0.0109, -0.527117],  # 넙적다리가운데점(Midthigh, 좌)
        [-0.091315, 0.08765, -0.860128],  # 오금점(Posterior Juncture of Calf and Thigh, 우)
        [0.091315, 0.08765, -0.860128],  # 오금점(Posterior Juncture of Calf and Thigh, 좌)
        [-0.106494, 0.121945, -1.02879],  # 장딴지돌출점(Calf Protrusion, 우)
        [0.106494, 0.121945, -1.02879],  # 장딴지돌출점(Calf Protrusion, 좌)
        [-0.095621, 0.023354, -1.26868],  # 종아리아래점(Inferior Leg, 우)
        [0.095621, 0.023354, -1.26868],  # 종아리아래점(Inferior Leg, 좌)
        [-0.062418, 0.04713, -1.31871],  # 안쪽복사점(Medial Malleous, 우)
        [0.062418, 0.04713, -1.31871],  # 안쪽복사점(Medial Malleous, 좌)
        [-0.128206, 0.082131, -1.31363],  # 가쪽복사점(Lateral Malleous, 우)
        [0.128206, 0.082131, -1.31363],  # 가쪽복사점(Medial Malleous, 좌)
    ]
    sitting = [
        [-0.105341, -0.090454, -0.624696],  # 앉은넙다리위점(Superior Thigh, Sitting, 우)
        [0.105341, -0.090454, -0.624696],  # 앉은넙다리위점(Superior Thigh, Sitting, 좌)
        [-0.09652, -0.04576, -0.868488],  # 앉은무릎뼈위점(Superior Patella, Sitting, 우)
        [0.09652, -0.04576, -0.868488],  # 앉은무릎뼈위점(Superior Patella, Sitting, 좌)
        [-0.095372, -0.023985, -0.916178],  # 앉은무릎앞점(Anterior Knee, Sitting, 우)
        [0.095372, -0.023985, -0.916178],  # 앉은무릎앞점(Anterior Knee, Sitting, 좌)
        [-0.091315, 0.08765, -0.860128],  # 오금점(Posterior Juncture of Calf and Thigh, 우)
        [0.091315, 0.08765, -0.860128],  # 오금점(Posterior Juncture of Calf and Thigh, 좌)
        [-0.178589, 0.010366, -0.388594],  # 앉은엉덩이최대돌출수준(Hip level, 우)
        [0.178589, 0.010366, -0.388594],  # 앉은엉덩이최대돌출수준(Hip level, 좌)
        [0.000002, -0.131549, -0.256985],  # 배돌출점(Stomach tip)
        [0.000001, 0.149724, -0.441748],  # 앉은엉덩이뒤돌출점
    ]
    return standing


if __name__ == "__main__":
    mesh = o3d.io.read_triangle_mesh(os.path.join(r"D:\Creadto\Utilities\Dataset-maker\contents\stm\165poses\sizekorea",
                                                  "origin-male.obj"))
    # coordi = o3d.geometry.TriangleMesh.create_coordinate_frame()
    # o3d.visualization.draw_geometries([mesh, coordi])
    find_indexes(np.asarray(mesh.vertices), get_alters())
